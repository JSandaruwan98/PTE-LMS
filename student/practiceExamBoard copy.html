<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,400,300,500,600,700" rel="stylesheet"> 
    <link rel="stylesheet" href="css/style_for_mycourse_dropdown.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/custome.css">
    <link rel="stylesheet" href="css/style.css">

    <style>
        #timer {
            font-size: 2em;
            text-align: center;
        } 
        .sidebar{
            display: none;
        }
        .profile-div{
            display: none;
        }
        #main{
            display: none;
        }
        #submit{
            text-align: center;
        }

        .tabs {
            display: flex;
            margin-bottom: 10px;
        }

        .tab {
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }

        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #8CDDFE;
            border-radius: 0 0 5px 5px;
        }

        .tab-content p {
            margin: 0;
        }

        .b1 {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .overlay-content-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
        }

        .content-popup {
            position: fixed;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 500px;
            background-color: #fcfafa;
            border: 1px solid #ccc;
            padding: 20px;
            text-align: center;
            display: none;
            box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

    
        
     </style>
     
     <script>
       
        $('#discussion').click(function(){
            $.ajax({
                url: 'discussion.html',
                type: 'GET',
                dataType: 'html',
                success: function(response) {
                    $('#sub-discussion').html(response);
                },
                error: function(error) {
                    console.error('Error fetching HTML:', error);
                }
            });
        });
       
      </script>

</head>
<body>
    <section>
        <h1 id="type_name" class="ms-5 pb-4 " style="top: -60px; font-weight: normal; font-size: 25px"></h1>
    </section>
    <section class="banner-area relative about-banner" id="home">	
        <div class="overlay overlay-bg" style="background-color: rgba(0, 65, 65, 0.5);"></div>
        <div class="container">				
            <div class="row d-flex align-items-center justify-content-center">
                <div class="about-content col-lg-12">
                    student/images/Rectangle 114.png
                </div>	
            </div>
        </div>
    </section>
    <section class="feature-area" id="block">
        <div class="container">
            <div class="row" >
                <div class="col-md-12" >
                    <div class="feature-area" id="feature-area">
                        <div class="single-feature" id="single-feature">
                            <div class="title" id="title" style="height: 70px; text-align: justify; padding: 15px;">
                               
                            </div>
                            <div class="desc-wrap" style="background-color: rgb(218, 253, 253); ">
                               
                                <!--************************************************************************************************************-->

                                <div class="row">
                                    <div class="col-2">
                                        <div style="color: red;">Prepair Time</div>
                                        <div id="prepair-timer" style="color: red;">00:00:00</div>
                                    </div>
                                    <div class="col-7">
                                        <div class="progress">
                                            <div id="myProgressBar" class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="col-2 ms-5">
                                        <div data-role="controls">
                                            <div id="timer">00:00:00</div>
                                        </div>
                                        <div data-role="recordings"></div>
                                    </div>
                                </div>  

                                <!--************************************************************************************************************-->

                                <div class="row">
                                    <div class="col-2"></div>
                                    <div class="col-7">
                                        <div id="solution" style="text-align: justify; color: #222; margin-top: 25px; padding-left: 30px; padding-right: 30px;"></div>
                                    </div>
                                    <div class="col-2 ms-5" style="text-align: cente;">
                                        <div data-role="controls">
                                            <button id="recordButton" style="height: 50px; width: 50px; padding-left: 50px;">Record</button>
                                            <a  href="#" id="submit" style="font-size: 20px; font-weight:400;">Submit</a>
                                            <div class="spinner-border text-primary" role="status" style="display:inline-block;">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </div>
                                        <div data-role="recordings"></div>
                                    </div>
                                </div>

                                <!--************************************************************************************************************-->
                                   
                                    <div class="row" style="margin-top: 60px;">
                                        <div class="col-2">
                                            <a  href="#" id="previous" style="font-size: 20px; font-weight:600; float: left;">Previuos</a>
                                        </div>
                                        <div class="col-8">
                                            <a style="font-size: 20px; font-weight:600;"><span id="currentPage">1</span> /<span id="totalPages">1</span></a>
                                        </div>
                                        <div class="col-2">
                                            <a  href="#" id="next" style="font-size: 20px; font-weight:600; float: right;">Next</a>	
                                        </div>
                                    </div>

                                <!--************************************************************************************************************-->    

                                </div>    
                            </div>
                        </div>
                    </div>
                </div>
         					
            </div>
        </div>	
    </section>
    <section style="margin-left: 90px; margin-top: 30px;">
        <audio controls style="width: 300px; height: 60px;">
            <source src="${data['data'][i].audio}" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </section>
    <section style="margin-left: 80px; margin-top: 30px;">
       <h5 style=" font-weight:300">AI Scoring and Audio Answer Download is available after submission.</h5>
    </section>
    <section style="margin-left: 80px; margin-top: 30px;">
        <button type="button" class="btn btn-outline-primary" style="width: 100px; height: 35px; font-size: 15px;">Re-do</button>
        <button type="button" class="btn btn-primary ms-4 text-white" style="width: 120px; height: 35px; font-size: 15px;">Translation</button>
    </section>
    <section style="margin-left: 80px; margin-top: 30px;">
        <h3 class="ms-5" style="font-size:medium;">Discussion</h3>
    </section>
    <section style="margin: 60px; margin-top: 30px;">
        <div type="button" class="tab btn btn-outline-primary" data-tab="tab1" style="width: 100px; height: 35px; font-size: 15px;">Discussion</div>
        <div type="button" class="tab btn btn-outline-primary" data-tab="tab2" style="width: 100px; height: 35px; font-size: 15px;">Board</div>
        <div type="button" class="tab btn btn-outline-primary" data-tab="tab3" style="width: 100px; height: 35px; font-size: 15px;">Me</div>
        <div class="tab-content" id="tab1">
            <p>Content for Tab 3 goes here.</p>
        </div>

        <!--*****************************************************************************************************************************************************-->
        
        <div class="tab-content" id="tab2">
            <div class="col-6">
                <div class="row d-flex">
                    <div class="col-md-12 col-lg-10 col-xl-8"><div class="card"><div class="card-body">
                        <div class="d-flex flex-start align-items-center">
                            <img class="rounded-circle shadow-1-strong me-3"
                              src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="60"
                              height="60" />
                            <div>
                                <h6 class="fw-bold text-primary" >Lily Coleman</h6>
                                <audio controls style="width: 250px; height: 40px;">
                                    <source src="${data['data'][i].audio}" type="audio/mpeg">
                                    Your browser does not support the audio element.
                                </audio>
                                <div class="btn btn-outline-primary fw-bold rounded"  style="font-size: 10px;">Score Info</div>
                            </div>
                        </div>
                    </div></div></div>
                </div>
            </div>
            <div class="col-6">
                <div class="row d-flex mt-4">
                    <div class="col-md-12 col-lg-10 col-xl-8"><div class="card"><div class="card-body">
                        <div class="d-flex flex-start align-items-center">
                            <img class="rounded-circle shadow-1-strong me-3"
                              src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="60"
                              height="60" />
                            <div   style="font-size: 10px;">
                                <h6 class="fw-bold text-primary mb-1">Lily Coleman<span class="pe-3" style="font-size: 13px; font-weight: 300; color: black; float: right;">  25/01/2024</span></h6>
                                <audio controls style="width: 250px; height: 40px;">
                                    <source src="${data['data'][i].audio}" type="audio/mpeg">
                                    Your browser does not support the audio element.
                                </audio>
                                <div id="score" class="btn btn-outline-primary fw-bold mb-1 rounded"   style="font-size: 10px;">Score Info</div>
                            </div>
                        </div>
                    </div></div></div>
                </div>
            </div>
        </div>

        <!--*****************************************************************************************************************************************************-->
        
        <div class="tab-content" id="tab3">
            
        </div>

        <!--*****************************************************************************************************************************************************-->

        <div class="b1">
            <div class="overlay-content-popup" id="overlay-content-popup"></div>
            <div id="cb" class="content-popup">
                <div class="container">
                    <div class="row">
                        <div style="text-align: left; font-weight: 300;">Score Info</div>
                    </div>
                    <div class="row mx-3">
                        <div class="col-5 py-3">
                            <div class="row px-2">
                                <div class="p-2">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div style="font-weight: 300;">Total</div>
                                </div>     
                            </div>
                            <div class="row px-2">
                                <div class="col-4 p-1">
                                    <div class="p-2"  style="background-color: white; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3); border-radius: 5px;">
                                        <span>Content</span><br><span style="color: green;">10/90</span>
                                    </div>
                                </div>
                                <div class="col-4 p-1">
                                    <div  class="p-2" style="background-color: white; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3); border-radius: 5px;">
                                        <span>Pronoun</span><br><span style="color: rgb(255, 162, 0);">10/90</span>
                                    </div>
                                </div>
                                <div class="col-4 p-1">
                                    <div class="p-2"  style="background-color: white; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3); border-radius: 5px;">
                                        <span>Fluency</span><br><span style="color: purple;">10/90</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row px-2">
                                <div class="p-2"></div><h4 class="h6" style="text-align: left;">Skill Analysis</h4>
                                <p class="lh-sm" style="font-weight: 500; font-size: 10px; text-align:justify">The following scores show how you have performed in different aspects as compared to other users. These scores can be used to analyse how you can improve in this question, but they are not directly related to the PTE scores.</p>
                            </div>
                            <div class="row">
                                <div class="p-2"  style="background-color: white; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3); border-radius: 5px;">
                                    <div>
                                        <div class="progress mt-1">
                                            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">20%</div>
                                        </div>
                                        <h4 class="h6" style="font-size: 10px; text-align: right;">Pronounciation Accuracy</h4>
                                    </div>
                                    <div>
                                        <div class="progress mt-1">
                                            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">20%</div>
                                        </div>
                                        <h4 class="h6" style="font-size: 10px; text-align: right;">Fluent</h4>
                                    </div>
                                    <div>
                                        <div class="progress mt-1">
                                            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">20%</div>
                                        </div>
                                        <h4 class="h6" style="font-size: 10px; text-align: right;">Stress</h4>
                                    </div>
                                    <div>
                                        <div class="progress mt-1">
                                            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">20%</div>
                                        </div>
                                        <h4 class="h6" style="font-size: 10px; text-align: right;">Speed</h4>
                                    </div>
                                </div>
                                    
                                
                            </div>
                            
                        </div>
                        <div class="col-7 ps-5">
                            <div class="row">
                                <div class="py-4" style="background-color: white; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3); border-radius: 5px;">
                                    <audio controls style="width: 300px;">
                                        <source src="${data['data'][i].audio}" type="audio/mpeg">
                                    </audio>
                                </div>
                            </div>
                            <div class="row px-2">
                                <div class="p-2"></div><h4 class="h6" style="text-align: left;">Content</h4>
                                <p style="font-weight: 300; font-size: 14px; text-align:justify">
                                    <span>Missed words<span style="margin-left: 15px; height: 13px; width: 13px; background-color: #b80707; border-radius: 50%; display: inline-block;"></span></span>
                                    <span style="margin-left: 40px;">Aditional words<span style="margin-left: 15px; height: 13px; width: 13px; background-color: #b80707; border-radius: 50%; display: inline-block;"></span>
                                </p>
                            </div>
                            <div class="row">
                                <div class="p-2"  style="background-color: white; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3); border-radius: 5px;">
                                    <p  style="font-weight: 500; font-size: 15px; text-align:justify">The following scores show how you have performed in different aspects as compared to other users. These scores can be used to analyse how you can improve in this question, but they are not directly related to the PTE scores.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
        </div>

    </section>
    <section id="sub-discussion" style="margin-left: 80px; margin-top: 30px;">
        <h1></h1>
    </section>

<!--***********************************************************************************************************************************************************-->
    <script src="js/tabClick.js"></script>
    <script src="js/scorePopUp.js"></script>    
<!--***********************************************************************************************************************************************************-->

        
    

    <!--<script>
        // Function to continuously increase the progress bar
        function increaseProgressBar() {
          var progressBar = $('#myProgressBar');
          var currentWidth = parseInt(progressBar.css('width'), 10);
          var newWidth = (currentWidth + 1) % 101; // Increment and loop back to 0 after reaching 100
          progressBar.css('width', newWidth + '%');
          progressBar.attr('aria-valuenow', newWidth);
        }
      
        // Set an interval to call the function every second
        setInterval(increaseProgressBar, 1000);
    </script>


    page number change jquery
    <script>
        $(document).ready(function() {
          var currentPage = 1;
          var totalPages = 10; // Replace this with your actual total number of pages
    
          // Function to update the page content (replace this with your actual data retrieval logic)
          function updateContent(page) {
            $("#content").html("<p>Content for Page " + page + "</p>");
          }
    
          // Function to update the pagination information
          function updatePagination() {
            $("#currentPage").text(currentPage);
            $("#totalPages").text(totalPages);
          }
    
          // Initial content and pagination update
          updateContent(currentPage);
          updatePagination();
    
          // Event listener for Previous button
          $("#previous").on("click", function() {
            if (currentPage > 1) {
              currentPage--;
              updateContent(currentPage);
              updatePagination();
            }
          });
    
          // Event listener for Next button
          $("#next").on("click", function() {
            if (currentPage < totalPages) {
              currentPage++;
              updateContent(currentPage);
              updatePagination();
            }
          });
        });
    
      </script>-->
       <script>
        $(document).ready(function () {
            
            

            let timer;
            let audioFile;
            let Solution;
            let KeyWords;
            let question_id;
            let seconds1 = 0;
            let seconds2 = 35;
            let minutes = 0;
            let hours = 0;
            let mediaRecorder;
            let audioChunks = [];
            let isRecording = false;
            let totalPages;

            var currentPage = 1;
            var questionsPerPage = 1; // Adjust as needed

            const audioPlayer = $('#audioPlayer');
            var progressBar = document.getElementById('myProgressBar');
            
            
            

            /**const urlParams = new URLSearchParams(window.location.href);//get the parsing data
            const fragment = window.location.hash;
            const value = fragment.substring(1);// Remove the '#' character to get the value**/
                    
            var fragment = window.location.hash;
            if (fragment.includes('type')) { var typeValue = parseInt(fragment.split('=')[1]); } 
            else { console.log('Type parameter not found in the URL.'); }

            console.log(typeValue);

            if(typeValue == 1){
                type = 'Read Aloud';
                image = 'images/img/78c8b120464e6b53b3877ad0de114ad3.jpg';
            }else if(typeValue == 2){
                type = 'Repeat Sentence';
                image = 'images/img/cta-bg.jpg';
            }else if(typeValue == 3){
                type = 'Describe image';
                image = 'images/img/top-banner.jpg';
            }else if(typeValue == 4){
                type = 'Re-tell Lecture';
                image = 'images/img/R.jpg';    
            }else if(typeValue == 5){
                type = 'Answer Short Question';
                image = 'images/img/slider3.png';        
            }

            console.log(type);

            $('#type_name').text(type);
            $('#home').css({'background': 'url('+image+') right'})


        /***********************************************************************************************************************************************************/
            
            function discussion(){
                $.ajax({
                    url: 'src/controllers/getController.php?data_type=discussion&question_id=71',
                    method: 'GET',
                    success: function(data){
                        console.log(data.length)
                        $('#tab3').empty();
                        for (var i = 0; i < data.length; i++) {
                            $('#tab3').append(`
                                <div class="col-6">
                                    <div class="row d-flex mt-5">
                                        <div class="col-md-12 col-lg-10 col-xl-8"><div class="card"><div class="card-body">
                                            <div class="d-flex flex-start align-items-center">
                                                <img class="rounded-circle shadow-1-strong me-3"
                                                src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="60"
                                                height="60" />
                                                <div>
                                                    <h6 class="fw-bold text-primary mb-1">`+data[i].name+`<span class="pe-3" style="font-size: 13px; font-weight: 300; color: black; float: right;">`+data[i].attempted_on+`</span></h6>
                                                    <audio controls style="width: 250px; height: 40px;">
                                                        <source src="`+data[i].mp4File+`" type="audio/mpeg">
                                                        Your browser does not support the audio element.
                                                    </audio>
                                                    <div class="btn btn-outline-primary fw-bold mb-1 rounded">Score Info</div>
                                                </div>
                                            </div>
                                        </div></div></div>
                                    </div>
                                </div>
                            `);
                        }
                        
                    },
                    error: function(){
                        alert('Error fetching data.');
                    }
                })
            }

            discussion()
        /***********************************************************************************************************************************************************/

            //get the database data of Questions
            
            function fetchAndDisplayQuestions(page) {
                $.ajax({
                    url: `src/controllers/getController.php?data_type=questionDisplay&page=${page}&per_page=${questionsPerPage}&test_id=${11}&type=${type}`,
                    method: 'GET',
                    success: function (data) {
                        startTimer(2)
                        // Clear existing content
                        $('#title').empty();
                        $('#Question').empty();
                        $('#solution').empty();
                        console.log(data)
                        totalPages = data['totalItems'].Count;
                        console.log(type)
                        
                        // Loop through the data and append it to the containers
                        for (var i = 0; i < data['data'].length; i++) {
                            Solution = data['data'][i].solution;
                            type = data['data'][i].type;
                            KeyWords = data['data'][i].key_words
                            question_id = data['data'][i].question_id;
                            $('#title').append(`<h2 style="color: white;">${data['data'][i].question}</h2>`);
                            if(type == "Read Aloud"){
                                $('#solution').append(`<p>${data['data'][i].solution}</p>`);
                            }else if(type == "Describe image"){
                                try{
                                    $('#solution').append(`<img src="${data['data'][i].imageFile}" style="width:450px; padding-left: 25%; height: 250px">`);
                                }catch(error){
                                    console.log(error.message)
                                }
                            }else if(type == "Repeat Sentence" || type == "Re-tell Lecture" || type == "Answer Short Question"){
                                $('#solution').append(`<audio controls style="padding-left: 25%">
                                                            <source src="${data['data'][i].audio}" type="audio/mpeg">
                                                            Your browser does not support the audio element.
                                                        </audio>`);
                                console.log(data['data'][i].imageFile)
                            }
                            
                        }

                        function updatePagination() {
                            $("#currentPage").text(currentPage);
                            $("#totalPages").text(totalPages);
                        }

                        updatePagination()
                    },
                    error: function () {
                        alert('Error fetching data.');
                    }
                });
            }
            
            
            fetchAndDisplayQuestions(currentPage);

            
            // Event listener for Previous button
            $("#previous").on("click", function() {
                if (currentPage > 1) {
                    currentPage--;
                    fetchAndDisplayQuestions(currentPage);
                    resetTimer(1);
                    resetTimer(2);
                }
            });
        
            // Event listener for Next button
            $("#next").on("click", function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    fetchAndDisplayQuestions(currentPage);
                    resetTimer(1);
                    resetTimer(2);
                }
            });
        
        /***********************************************************************************************************************************************************/    

            //timer function
            //task has two type 1 => Answering timer 2 => prepair timer

            function startTimer(task) {
                timer = setInterval(function(){updateTimer(task)}, 1000);
            }

            function stopTimer() {
                clearInterval(timer);
                console.log('timer off')
            }

            function resetTimer(task) { 
                console.log('timer reset')              
                clearInterval(timer);
                if(task==1){
                    seconds1 = 0;
                    progressBar.style.width = 0+'%'
                }else if(task == 2){
                    seconds2 = 35;
                }
                minutes = 0;
                hours = 0;
                updateTimerDisplay(task);
            }

            function updateTimer(task) {
                if(task==2){
                    seconds2--;
                    if (seconds2 === 0) {
                        clearInterval(timer);
                        toggleRecordingButton.click();                        
                    }
                }else if(task==1){
                    //this is progress increasing
                    var currentWidth = parseFloat(progressBar.style.width, 10);
                    var newWidth = (currentWidth + 2.5) % 101; 
                    progressBar.style.width = newWidth + '%';

                    seconds1++;
                    if (seconds1 === 40) {
                        clearInterval(timer);
                        toggleRecordingButton.click();
                    }
                }else if(task==3){
                    seconds1++;
                    if (seconds1 === 60) {
                    seconds1 = 0;
                    minutes++;
                    if (minutes === 60) {
                        minutes = 0;
                        hours++;
                    }
                    }
                }
                updateTimerDisplay(task);
            }

            function updateTimerDisplay(task) { 
                if(task==1){
                    const formattedTime = `${pad(hours)}:${pad(minutes)}:${pad(seconds1)}`;
                    $("#timer").text(formattedTime);
                }else if(task==2){
                    const formattedTime = `${pad(hours)}:${pad(minutes)}:${pad(seconds2)}`;
                    $("#prepair-timer").text(formattedTime);
                }
            }

            function pad(value) {
                return value < 10 ? `0${value}` : value;
            }

        /***********************************************************************************************************************************************************/
  
            //recording button action
            const toggleRecordingButton = $('#recordButton');

            toggleRecordingButton.on('click', function () {
                if (!isRecording) {
                    stopTimer()
                    resetTimer(1)
                    startTimer(1)
                    startRecording();
                    toggleRecordingButton.text('Stop Recording');
                } else {
                    stopTimer()
                    stopRecording();
                    toggleRecordingButton.text('Start Recording');
                }
                isRecording = !isRecording;
            });

            /***********************************************************************************************************************************************************/

            //recording start function
            
            function startRecording() {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function (stream) {
                        mediaRecorder = new MediaRecorder(stream);

                        mediaRecorder.ondataavailable = function (event) {
                            if (event.data.size > 0) {
                                audioChunks.push(event.data);
                            }
                        };

                        mediaRecorder.onstop = function () {
                            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                            const audioUrl = URL.createObjectURL(audioBlob);
                            audioPlayer.attr('src', audioUrl);
                            console.log(audioUrl)
                            const formData = new FormData();
                            formData.append('audio', audioBlob, 'recording.wav');
                            formData.append('task','save_audio');

                            // Send the recorded audio to the server using $.ajax or $.post
                            saveAudio(formData);

                            audioChunks = [];
                        };

                        mediaRecorder.start();
                        toggleRecordingButton.prop('disabled', false);
                    })
                    .catch(function (error) {
                        console.error('Error accessing microphone:', error);
                    });
            }

        /***********************************************************************************************************************************************************/    

            //recording stop function

            function stopRecording() {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
            }

        /***********************************************************************************************************************************************************/    

            //recording save function

            
            function saveAudio(formData) {
                // Send the recorded audio data to the server using $.ajax or $.post
                $.ajax({
                    url: 'src/controllers/postController.php',
                    method: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        console.log('Audio saved successfully:');
                        console.log(response.audioFile1);
                        console.log(response.audioFile2);
                        console.log(response)
                        audioFile = response.audioFile1;
                    },
                    error: function (error) {
                        console.error('Error saving audio:', error);
                    }
                });
            }

        /***********************************************************************************************************************************************************/
        
            $('#submit').on('click', function(){
                console.log(type);
                console.log(KeyWords);
                if(type == 'Read Aloud' || type == 'Repeat Sentence'){
                    task = 'normal_comparison'
                }else if(type == 'Describe image' || type == 'Repeat Sentence' || type == 'Answer Short Question'){
                    task = 'ai_analysis'
                }

                $.ajax({
                    url:'src/controllers/postController.php',
                    type: 'POST',
                    data: { task : task, audioFile: audioFile, Solution: Solution, question_id: question_id, student_id: 2, key_words: KeyWords, type: type},
                    success: function(response){
                        if(response.success){
                            console.log(response.message);
                            discussion()
                        }else{
                            console.log(response.message);
                            
                        }
                    },
                    error: function (error) {
                        console.log(response.message);
                        console.log(response.comment);
                        console.error('Error saving audio:', error); 
                    }
                })
            });
        
        })

        /***********************************************************************************************************************************************************/

        
      </script>
</body>
</html>